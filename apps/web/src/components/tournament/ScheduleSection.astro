---
// Программа турнира
// Цвета из Figma:
// Фон секции: #D85A21 (Orange)
// Карточки: #0F0F0F (Dark)
// Текст: #FFFFFF

import ScheduleCard from './ScheduleCard.astro';
import scheduleData from '../../content/schedule/index.json';

type ScheduleDay = { time: string; event: string };
const { showSection = true } = scheduleData;
---

{showSection && (
<section class="relative bg-[#D85921] py-[100px] px-5 overflow-hidden min-h-[900px] flex flex-col items-center" id="schedule">
  <!-- Background Top Fade -->
  <div class="absolute inset-0 z-0 bg-linear-to-b from-black/20 via-transparent to-transparent pointer-events-none"></div>

  <!-- Background Elements -->
  <div class="absolute inset-0 z-0 overflow-hidden pointer-events-none">
    <!-- Player Left (Figma: x -384px, y 23px) -->
    <div id="schedule-parallax-player" class="absolute left-[-380px] top-[20px] h-[1150px] w-auto z-[1] max-lg:hidden">
        <img src="/tournament/schedule-player.png" alt="" class="h-full w-auto object-contain rotate-180 -scale-y-100" />
    </div>
    
    <!-- Court Right (Figma: x 86%, rotate -70.39deg) -->
    <div id="schedule-parallax-court" class="absolute right-[-400px] top-[20%] w-[1200px] h-auto z-[1] max-lg:hidden">
        <img src="/tournament/schedule-court.png" alt="" class="w-full h-auto object-contain -rotate-[70deg]" />
    </div>
    
    <!-- Затемнение Bottom -->
    <!-- Затемнение Bottom -->
    <div class="absolute bottom-0 left-0 w-full h-[317px] z-[2] pointer-events-none" style="background: linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.03) 12.34%, rgba(0, 0, 0, 0.7) 90%, #000 100%);"></div>
  </div>

  <div class="relative z-10 w-full max-w-[1440px] flex flex-col items-center">
    <header class="text-center mb-[60px]">
      <h2 class="font-bebas font-bold text-[64px] text-white leading-none m-0 uppercase tracking-tight">Программа турнира</h2>
      <p class="!font-montserrat font-semibold text-[16px] text-white/90 mt-4 mb-0 uppercase tracking-[0.2em]">Полное расписание на 2 дня</p>
    </header>

    <!-- Tabs -->
    <div class="flex gap-4 mb-[50px]">
      <button class="tournament-schedule__tab active flex items-center justify-center bg-[#0F0F0F] rounded-lg py-5 px-12 cursor-pointer transition-all duration-300 min-w-[240px] border-2 border-transparent hover:border-white/20" data-tab="day1">
        <span class="font-montserrat text-[28px] font-semibold text-white leading-none">13 марта</span>
      </button>
      <button class="tournament-schedule__tab flex items-center justify-center bg-[#0F0F0F]/80 rounded-lg py-5 px-12 cursor-pointer transition-all duration-300 min-w-[240px] border-2 border-transparent hover:border-white/20" data-tab="day2">
        <span class="font-montserrat text-[28px] font-semibold text-white/50 leading-none">14 марта</span>
      </button>
    </div>

    <!-- Content -->
    <div class="w-full max-w-[800px] relative">
      <!-- Day 1 List -->
      <div class="tournament-schedule__list flex flex-col gap-3 w-full transition-all duration-500 active" id="day1">
        {scheduleData.day1.map((item) => (
          <ScheduleCard time={item.time} event={item.event} />
        ))}
      </div>

      <!-- Day 2 List -->
      <div class="tournament-schedule__list hidden flex flex-col gap-3 w-full transition-all duration-500" id="day2">
        {scheduleData.day2.map((item) => (
          <ScheduleCard time={item.time} event={item.event} />
        ))}
      </div>
    </div>
  </div>
</section>
)}

<script>
  const tabs = document.querySelectorAll('.tournament-schedule__tab');
  const lists = document.querySelectorAll('.tournament-schedule__list');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const targetId = tab.getAttribute('data-tab');

      // Update tabs styles
      tabs.forEach(t => {
        t.classList.remove('active');
        const span = t.querySelector('span');
        if (span) {
          span.classList.remove('text-white');
          span.classList.add('text-white/50');
        }
      });
      
      tab.classList.add('active');
      const activeSpan = tab.querySelector('span');
      if (activeSpan) {
        activeSpan.classList.remove('text-white/50');
        activeSpan.classList.add('text-white');
      }

      // Update visibility of lists
      lists.forEach((l) => {
        if (l.id === targetId) {
          l.classList.remove('hidden');
          setTimeout(() => l.classList.add('active'), 0);
        } else {
          l.classList.add('hidden');
          l.classList.remove('active');
        }
      });
    });
  });

  // Parallax for background elements
  const player = document.getElementById('schedule-parallax-player');
  const court = document.getElementById('schedule-parallax-court');

  if (player || court) {
    window.addEventListener('scroll', () => {
      const scrolled = window.scrollY;
      const section = document.getElementById('schedule');
      if (!section) return;

      const sectionTop = section.offsetTop;
      const sectionHeight = section.offsetHeight;
      const viewportBottom = scrolled + window.innerHeight;

      if (viewportBottom > sectionTop && scrolled < sectionTop + sectionHeight) {
        const relativeScroll = scrolled - sectionTop;
        
        if (player) {
          player.style.transform = `translateY(${relativeScroll * 0.12}px)`;
        }
        if (court) {
          court.style.transform = `translateY(${relativeScroll * 0.08}px)`;
        }
      }
    }, { passive: true });
  }
</script>

<style>
  .tournament-schedule__list {
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.5s ease-out;
  }
  
  .tournament-schedule__list.active {
    opacity: 1;
    transform: translateY(0);
  }
</style>