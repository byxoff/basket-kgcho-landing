---
// Секция магазина официальной атрибутики
import ShopCard from './ShopCard.astro';
// Функция для получения правильного пути к картинке (поддержка и строк, и импортов Vite)
const shopImages = import.meta.glob('/src/assets/content/shop/**/*.{jpeg,jpg,png,gif,webp,svg}');

// Safe Data Load
const shopFiles = import.meta.glob('../../content/shop/index.json', { eager: true });
const shopData = shopFiles['../../content/shop/index.json'] || { items: [] };

const { items: shopItems = [], showSection = true } = shopData;
---

{showSection && (
<section class="relative py-24 px-5 bg-black overflow-hidden flex flex-col items-center" id="shop">
  <!-- Background -->
  <div class="absolute inset-0 z-0">
    <img src="/tournament/shop-section-bg.png" alt="" class="w-full h-full object-cover opacity-80" />
    <!-- Gradient Fade Bottom -->
    <div class="absolute bottom-0 left-0 w-full h-[317px] z-1 pointer-events-none" style="background: linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.03) 12.34%, rgba(0, 0, 0, 0.7) 90%, #000 100%);"></div>
  </div>

  <div class="relative z-10 w-full max-w-[1440px] flex flex-col items-center">
    <header class="text-center mb-[60px]">
      <h2 class="font-bebas font-bold text-[64px] text-white leading-none m-0 uppercase tracking-tight">Магазин</h2>
      <p class="!font-montserrat font-semibold text-[16px] text-white/90 mt-4 mb-0 uppercase tracking-[0.2em]">Официальная атрибутика турнира</p>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-y-10 gap-x-6 w-full max-w-[1400px] justify-items-center">
       {shopItems.map((item) => {
         let imgImport = null;
         if (item && item.image) {
             const rawPath = item.image;
             // Превращаем @assets/content/shop/image.png -> /src/assets/content/shop/image.png
             const fsPath = rawPath?.replace('@assets/content', '/src/assets/content');
             imgImport = shopImages[fsPath];
         }
         return (
         <ShopCard 
            title={item.title}
            price={item.price}
            image={item.image}
            imgImport={imgImport}
            link={item.link}
            openInNewTab={item.openInNewTab}
         />
       )})}
    </div>
  </div>
</section>
)}

